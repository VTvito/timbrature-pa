<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#007aff">
    <meta name="description" content="App per tracciare orari di ingresso e uscita dal lavoro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Timbra PA">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ğŸ• Timbra PA</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" sizes="192x192" href="icons/icon-192.svg">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Install Banner PWA (per nuovi visitatori) -->
    <div id="installBanner" class="install-banner" style="display: none;">
        <div class="install-banner-content">
            <div class="install-banner-icon">ğŸ“²</div>
            <div class="install-banner-text">
                <strong>Installa Timbra PA</strong>
                <span id="installBannerHint">Usa l'app offline, sempre a portata di mano!</span>
            </div>
            <button id="installBannerBtn" class="btn btn-install-banner">Installa</button>
            <button id="installBannerClose" class="btn btn-install-close" aria-label="Chiudi">âœ•</button>
        </div>
    </div>
    
    <!-- iOS Install Instructions (shown on Safari) -->
    <div id="iosInstallModal" class="modal" role="dialog" aria-modal="true">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>ğŸ“² Installa su iPhone</h2>
                <button class="modal-close" id="iosModalClose" aria-label="Chiudi">&times;</button>
            </div>
            <div class="modal-body ios-instructions">
                <div class="ios-step">
                    <span class="ios-step-number">1</span>
                    <span>Apri in <strong>Safari</strong> e tocca <strong>Condividi</strong></span>
                    <span class="ios-icon-large">â¬†ï¸</span>
                </div>
                <div class="ios-step">
                    <span class="ios-step-number">2</span>
                    <span>Scorri e scegli <strong>"Aggiungi a Home"</strong></span>
                    <span class="ios-icon-large">â•</span>
                </div>
                <div class="ios-step">
                    <span class="ios-step-number">3</span>
                    <span>Conferma con <strong>"Aggiungi"</strong> in alto a destra</span>
                    <span class="ios-icon-large">âœ…</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="iosModalOk">Ho capito!</button>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>ğŸ• Timbra PA</h1>
            <button id="installBtn" class="btn btn-install" style="display: none;">
                ğŸ“² Installa App
            </button>
        </header>

        <!-- Week Navigation -->
        <nav class="week-navigation">
            <button id="prevWeekBtn" class="btn btn-nav" aria-label="Settimana precedente">
                â—€ Sett. Prec.
            </button>
            <div class="week-indicator">
                <span id="weekLabel" class="week-label">Settimana 5</span>
                <span id="yearLabel" class="year-label">2026</span>
                <span id="currentWeekBadge" class="badge badge-current" style="display: none;">Corrente</span>
            </div>
            <button id="nextWeekBtn" class="btn btn-nav" aria-label="Settimana successiva">
                Sett. Succ. â–¶
            </button>
        </nav>

        <!-- Action Buttons -->
        <section class="action-buttons">
            <button id="entrataBtn" class="btn btn-action btn-entrata">
                ğŸŸ¢ Entrata
            </button>
            <button id="uscitaBtn" class="btn btn-action btn-uscita">
                ğŸ”´ Uscita
            </button>
            <button id="smartBtn" class="btn btn-action btn-smart">
                ğŸ  Smart
            </button>
            <button id="assenteBtn" class="btn btn-action btn-assente">
                âŒ Assente
            </button>
        </section>
        <p class="usage-guidance" id="usageGuidance">Suggerimento: usa i pulsanti sopra per timbrare. <strong>Correggi</strong> serve solo per modifiche manuali.</p>
        
        <!-- Add Entry Button (for past/future days) -->
        <section class="add-entry-section">
            <button id="addEntryBtn" class="btn btn-add-entry">
                â• Aggiungi registrazione su altro giorno
            </button>
        </section>

        <!-- Week Days List -->
        <main class="week-days" id="weekDays">
            <!-- Days will be rendered here dynamically -->
        </main>

        <!-- Week Summary -->
        <section class="week-summary" id="weekSummary">
            <div class="summary-row">
                <span class="summary-label">Totale Settimana:</span>
                <span id="totalHours" class="summary-value">00:00</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Ore Richieste:</span>
                <span class="summary-value">36:00</span>
            </div>
            <div class="summary-row summary-balance">
                <span class="summary-label">Saldo:</span>
                <span id="balanceHours" class="summary-value balance-neutral">+00:00</span>
            </div>
        </section>

        <!-- Export/Import Buttons -->
        <section class="export-buttons">
            <button id="exportJsonBtn" class="btn btn-export">
                ğŸ“„ Esporta JSON
            </button>
            <button id="exportExcelBtn" class="btn btn-export">
                ğŸ“Š Esporta Excel
            </button>
            <button id="importBtn" class="btn btn-export">
                ğŸ“¥ Importa
            </button>
            <input type="file" id="importFile" accept=".json" style="display: none;">
            <button id="backupBtn" class="btn btn-export">
                ğŸ’¾ Esporta Backup JSON
            </button>
        </section>
        
        <!-- App Footer with Install Link -->
        <footer class="app-footer">
            <a href="#" id="showInstallHelp" class="install-help-link">
                ğŸ“² Installa l'app sul tuo dispositivo
            </a>
            <span class="app-version" id="appVersion">v1.9 â€¢ Dati salvati solo sul tuo dispositivo ğŸ”’</span>
        </footer>
    </div>

    <!-- Modal Add Entry (Nuova registrazione) -->
    <div id="addEntryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="addEntryModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addEntryModalTitle">â• Nuova Registrazione</h2>
                <button class="modal-close" data-action="close" aria-label="Chiudi">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addEntryForm">
                    <div class="form-group">
                        <label for="addDate">Data</label>
                        <input type="date" id="addDate" required>
                    </div>
                    <div class="form-group">
                        <label for="addType">Tipo</label>
                        <select id="addType" required>
                            <option value="entrata">ğŸŸ¢ Entrata</option>
                            <option value="uscita">ğŸ”´ Uscita</option>
                            <option value="smart">ğŸ  Smart Working</option>
                            <option value="assente">âŒ Assente</option>
                        </select>
                    </div>
                    <div class="form-group" id="addTimeGroup">
                        <label for="addTime">Orario</label>
                        <input type="time" id="addTime" value="08:00" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="close">Annulla</button>
                <button class="btn btn-primary" data-action="add">â• Aggiungi</button>
            </div>
        </div>
    </div>

    <!-- Modal Edit Entry -->
    <div id="editModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="editModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="editModalTitle">Modifica Registrazione</h2>
                <button class="modal-close" data-action="close" aria-label="Chiudi">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <div class="form-group">
                        <label for="editDate">Data</label>
                        <input type="date" id="editDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editType">Tipo</label>
                        <select id="editType" required>
                            <option value="entrata">ğŸŸ¢ Entrata</option>
                            <option value="uscita">ğŸ”´ Uscita</option>
                            <option value="smart">ğŸ  Smart Working</option>
                            <option value="assente">âŒ Assente</option>
                        </select>
                    </div>
                    <div class="form-group" id="timeGroup">
                        <label for="editTime">Orario</label>
                        <input type="time" id="editTime" required>
                    </div>
                    <input type="hidden" id="editIndex">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" data-action="delete">ğŸ—‘ï¸ Elimina</button>
                <button class="btn btn-secondary" data-action="close">Annulla</button>
                <button class="btn btn-primary" data-action="save">ğŸ’¾ Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirm -->
    <div id="confirmModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="confirmModalTitle">Conferma</h2>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Sei sicuro?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="cancel">Annulla</button>
                <button class="btn btn-danger" data-action="confirm">Conferma</button>
            </div>
        </div>
    </div>

    <!-- Modal Clean Data -->
    <div id="cleanDataModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="cleanDataTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="cleanDataTitle">ğŸ§¹ Pulizia Dati Vecchi</h2>
            </div>
            <div class="modal-body">
                <p>Sono stati trovati dati piÃ¹ vecchi di 3 mesi:</p>
                <ul id="oldWeeksList" class="old-weeks-list"></ul>
                <p class="warning-text">âš ï¸ Prima della pulizia Ã¨ consigliato usare "Esporta Backup JSON".</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="cancel">Annulla</button>
                <button class="btn btn-warning" data-action="clean">Pulisci Dati Vecchi</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Scripts (ES6 Modules) -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
